<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Cox-Beta Model</title>

<script src="libs/jquery/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap/js/bootstrap.min.js"></script>
<script src="libs/bootstrap/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 70px;
}
p code {
  white-space: inherit;
}
.panel-heading {
  text-align: center;
}
</style>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; }
code > span.dt { color: #204a87; }
code > span.dv { color: #0000cf; }
code > span.bn { color: #0000cf; }
code > span.fl { color: #0000cf; }
code > span.ch { color: #4e9a06; }
code > span.st { color: #4e9a06; }
code > span.co { color: #8f5902; font-style: italic; }
code > span.ot { color: #8f5902; }
code > span.al { color: #ef2929; }
code > span.fu { color: #000000; }
code > span.er { font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
          <span class="icon-bar"></span>
            <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="./index.html">CBR</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                  <ul class="nav navbar-nav">
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples<b class="caret"></b></a>
                      <ul class="dropdown-menu">
                        <li><a href="cox-beta.html">Cox-Beta</a></li>
                        <li><a href="rf-proximity.html">RF-Proximity</a></li>
                        <li><a href="rf-depth.html">RF-Depth</a></li>
                        <li><a href="manifold-learning.html">Manifold Learning</a></li>
                      </ul>
                    </li>
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation<b class="caret"></b></a>
                    <!--  <ul class="dropdown-menu">
                        <li><a href="class-structure.html">Class Structure</a></li>
                        <li><a href="distance-measures.html">Distance Measures</a></li>
                      </ul>-->
                    </li>
                    <li><a href="about.html">About</a></li>
                  </ul>
                                <ul class="nav navbar-nav navbar-right">
                                  <li><a href="https://github.com/sipemu/case-based-reasoning" title="View Source on Github"><i class="fa fa-github fa-lg"></i></a></li>
                                    </ul>
                                    </div><!--/.nav-collapse -->
                                    </div><!--/.container -->
                                    </nav><!--/.navbar -->

<div id="header">
<h1 class="title">Cox-Beta Model</h1>
</div>


<hr />
<div id="initialization" class="section level1">
<h1><span class="header-section-number">1</span> Initialization</h1>
<p>In the first example, we use the Cox-Model and the <code>ovarian</code> data set from the <code>survival</code> package. In the first step we initialize the R6 data object. The initialization needs several inputs:</p>
<p><strong>Arguments:</strong></p>
<table>
<tbody>
<tr class="odd">
<td align="left"><em>learning</em></td>
<td align="left">data set for learning the Cox model</td>
</tr>
<tr class="even">
<td align="left"><em>verumData</em></td>
<td align="left">Verum data set. For each case in the verum data, we are looking for the m (=1,…,k) similar cases. Learning and verum data set need the same structure (variable names and scales)</td>
</tr>
<tr class="odd">
<td align="left"><em>learnVars (optional)</em></td>
<td align="left">A character vector variable names. This variables are used for learning the model. Do not include time2event and event variable here. Default: all variables, except endPoint variables, are used for model fitting.</td>
</tr>
<tr class="even">
<td align="left"><em>endPoint (optional)</em></td>
<td align="left">A character vector of length two. The first elements contains the variable name of the time 2 event variable and the second the name of the event variable. Default: <code>c(&quot;Time2Event&quot;, &quot;Event&quot;)</code></td>
</tr>
<tr class="odd">
<td align="left"><em>impute (optional)</em></td>
<td align="left">TRUE/FALSE: Missing value imputation. Actually, not implemented for the Cox Model.</td>
</tr>
</tbody>
</table>
<p><br></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)
<span class="kw">library</span>(cbr)

<span class="co"># all variables should be numeric or factor</span>
ovarian$resid.ds &lt;-<span class="st"> </span><span class="kw">factor</span>(ovarian$resid.ds)
ovarian$rx &lt;-<span class="st"> </span><span class="kw">factor</span>(ovarian$rx)
ovarian$ecog.ps &lt;-<span class="st"> </span><span class="kw">factor</span>(ovarian$ecog.ps)

<span class="co"># initialize R6 object</span>
sc &lt;-<span class="st"> </span>cbrCoxModel$<span class="kw">new</span>(<span class="dt">learning=</span>ovarian, <span class="dt">verumData=</span>ovarian, <span class="dt">learnVars=</span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;resid.ds&quot;</span>, <span class="st">&quot;rx&quot;</span>, <span class="st">&quot;ecog.ps&quot;</span>), <span class="dt">endPoint=</span><span class="kw">c</span>(<span class="st">&quot;futime&quot;</span>, <span class="st">&quot;fustat&quot;</span>), <span class="dt">impute=</span>F)</code></pre>
<pre><code>## Dropped cases with missing values: 0
## Dropped cases with missing values: 0</code></pre>
<p>If <code>impute</code> is set to <code>FALSE</code> (for the Cox model the <code>ìmpute</code> variable is always set to <code>FALSE</code>) then all cases with missing values in the learning and end point variables are dropped (<code>na.omit</code>) and the reduced data set without missing values is saved internally. You get a text output on how many cases were dropped. The variables should be <code>numeric</code> or <code>factor</code>.</p>
</div>
<div id="similar-cases" class="section level1">
<h1><span class="header-section-number">2</span> Similar Cases</h1>
<p>After the initialization, we may get for each case in verum data the most similar case from the learning data.</p>
<pre class="sourceCode r"><code class="sourceCode r">sc$<span class="kw">getSimilarCases</span>(<span class="dt">nCases =</span> <span class="dv">1</span>)</code></pre>
<pre><code>## Start caclulating similar cases...
## Start learning...
## Learning finished in: 0.03 seconds.
## Similar cases calculation finished in: 0.04 seconds.</code></pre>
<p>You may extract then the similar cases and the verum data and put them together:</p>
<pre class="sourceCode r"><code class="sourceCode r">verum &lt;-<span class="st"> </span>sc$<span class="kw">getVerumData</span>()
verum$group &lt;-<span class="st"> &quot;Verum&quot;</span>
simCases &lt;-<span class="st"> </span>sc$simCases
simCases$caseId &lt;-<span class="st"> </span><span class="ot">NULL</span>
simCases$group &lt;-<span class="st"> &quot;Similar Cases&quot;</span>
df &lt;-<span class="st"> </span><span class="kw">rbind</span>(verum, simCases)</code></pre>
<p><strong>Note 1:</strong> In the initialization step, we dropped all cases with missing values in the variables of <code>learnVars</code> and <code>endPoint</code>. The function <code>sc$getVerumData()</code> returns the data set without the cases with missing values in the learning vars, except in the randomForest model where you have the option to impute missing values.</p>
<p><strong>Note 2:</strong> The <code>data.frame</code> returned from <code>sc$simCases</code> has an additional column <code>caseId</code>. By this column you may map the similar cases to cases in verum data, e.g. if you had chosen <code>nCases = 3</code>, then the first three elements in the column <code>caseId</code> will be <code>1</code> (following three <code>2</code> and so on). This means that this three cases are the three most similar cases to case <code>1</code> in verum data.</p>
<div id="check-linearity-and-proportional-hazard-assumption" class="section level2">
<h2><span class="header-section-number">2.1</span> Check Linearity and Proportional Hazard Assumption</h2>
<p>There are two functions for checking on the linearity of any independent <code>numeric</code> variable and the proportional hazard assumption for all dependent variables. Actually, it is not able to correct for non-linearity in the distance calculation.</p>
<pre class="sourceCode r"><code class="sourceCode r">pp &lt;-<span class="st"> </span>sc$<span class="kw">check_linearity</span>()
pp</code></pre>
<p><img src="cox-beta_files/figure-html/unnamed-chunk-4-1.png" title="" alt="" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">pp &lt;-<span class="st"> </span>sc$<span class="kw">check_ph</span>()
pp</code></pre>
<p><img src="cox-beta_files/figure-html/unnamed-chunk-5-1.png" title="" alt="" width="672" /></p>
</div>
<div id="validation-of-the-matching-variables" class="section level2">
<h2><span class="header-section-number">2.2</span> Validation of the matching Variables</h2>
<p>You may want to check the distibution of the <code>learnVars</code> variables of the verum and similar cases data set:</p>
<pre class="sourceCode r"><code class="sourceCode r">pp &lt;-<span class="st"> </span>sc$<span class="kw">validate</span>()</code></pre>
<pre><code>## Two-sample Wilcoxon test for variable: age; p = 0.905
## Chi-Square test for variable: resid.ds; p = 1
## Chi-Square test for variable: rx; p = 1
## Chi-Square test for variable: ecog.ps; p = 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pp</code></pre>
<p><img src="cox-beta_files/figure-html/unnamed-chunk-6-1.png" title="" alt="" width="672" /> <br> The function <code>sc$validate()</code> returns an <code>gg</code> and <code>ggplot</code> object.</p>
</div>
</div>
<div id="distance-matrix" class="section level1">
<h1><span class="header-section-number">3</span> Distance Matrix</h1>
<p>Alternatively, you may just be interested in the distance matrix, then you go this way:</p>
<pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>cbrCoxModel$<span class="kw">new</span>(<span class="dt">learning=</span>ovarian, <span class="dt">verumData=</span>ovarian, <span class="dt">learnVars=</span><span class="kw">names</span>(ovarian)[-<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)], <span class="dt">endPoint=</span><span class="kw">c</span>(<span class="st">&quot;futime&quot;</span>, <span class="st">&quot;fustat&quot;</span>), <span class="dt">impute=</span>F)</code></pre>
<pre><code>## Dropped cases with missing values: 0
## Dropped cases with missing values: 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">sc$<span class="kw">getFullDistanceMatrix</span>()</code></pre>
<pre><code>## Start learning...
## Learning finished in: 0.02 seconds.
## Start calculating distance matrix...
## Distance matrix calculation finished in: 0 seconds.</code></pre>
<p><code>sc$getFullDistanceMatrix()</code> calculates the full distance matrix. This matrix the dimension: cases of learning data versus cases of verum data. In the above example we used the same data set for learning and as verum data. Such case can also be achieved by:</p>
<pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>cbrCoxModel$<span class="kw">new</span>(<span class="dt">learning=</span>ovarian, <span class="dt">learnVars=</span><span class="kw">names</span>(ovarian)[-<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)], <span class="dt">endPoint=</span><span class="kw">c</span>(<span class="st">&quot;futime&quot;</span>, <span class="st">&quot;fustat&quot;</span>), <span class="dt">impute=</span>F)

sc$<span class="kw">getFullDistanceMatrix</span>()</code></pre>
<p>The distance matrix is saved internally in the sc object: <code>sc$distMat</code>.</p>
<p><br></p>
</div>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
    // active menu
    var href = window.location.pathname;
    href = href.substr(href.lastIndexOf('/') + 1);
    if (href === '') href = './';
    $('a[href="' + href + '"]').parent().addClass('active');
});
</script>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
